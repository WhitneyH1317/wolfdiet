---
title: "Wolfdiet R package Documentation"
author: ""
date: ""
output: 
  github_document:
    fig_width: 4
    fig_height: 4
    toc: true
    toc_depth: 2
  html_document:
    self_contained: no
always_allow_html: yes
---
  
```{R eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(knitr)
library(kableExtra)
library(DBI)
library(RPostgreSQL)
library(htmlwidgets)
library(wolfdiet)
library(keyring)

db <- 'wolfdiet'
# RUN ONLY THE FIRST TIME 
#key_set(service=db)
user <- keyring::key_list(db)$username[1]
if(.Platform['OS.type'] == "windows"){
  pw <- keyring::key_get(service=db, username=user) 
} else {
  pw <- keyring::key_get(service=db)
  }

con <- DBI::dbConnect("PostgreSQL", 
                 dbname = db, 
                 host = 'localhost', 
                 user = user, 
                 password = pw)
```

# Table of Contents

* [wolfdiet](#wolfdiet)
  * [1. The Database](#database)
    * [1.1. SCHEMAS](#schemas)
    * [1.2. TABLES](#tables)
    * [1.3. VIEWS](#views)
  * [2. Tutorials](#tutorials)
    * [2.1. DATABASE CONNECTION PARAMETERS](#connection)
    * [2.2. POSTGRESQL](#postgresql)
    * [2.3. R](#r)
  * [3. References](#references)
                    
# <a name="wolfdiet"></a> wolfdiet
                    
description 

## <a name="database"></a> 1. The Database 
                    
Before starting, to familiarize and navigate through the database it might be interesting to install postgresql and pgadmin4 on your desktop. pgAdmin is a graphical user interface that makes it easy to navigate through your database and postgresql is the language allowing to interact with and query the database. [Click here](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads) to download and install both required software. Once installed, connect to the database by following the steps as described in Figure 2 (**TBD**).
                    
<!-- <center> -->

<!-- ![**Figure 2.** How to connect to the database in pgAdmin](Documentation_files/figure-png/connect_to_db.png) -->

<!-- </center> -->
                    
### <a name="schemas"></a> 1.1. SCHEMAS
                    
A database is generally organised in different schemas. In this database we differentiate schemas based on their specific purpose. Different schemas may have different access properties and priviliges. We distinguish six different schemas (Figure 3; main, raster, lu_tables, temp, tools, public) and discuss them in order of relevance for the user.  
                    
<center>

![**Figure 3.** Screenshot of schemas in the postgresql database](Documentation_files/figure-png/schemas.png)

</center>
                      
#### 1.1.1. main 
                      
The schema "main" is where the main tables are stored. The data model of the database will be described in more detail below. 

#### 1.1.2. lu_tables 
                    
The schema "lu_tables" is where the look up tables (lu_tables) are stored. These tables store the list and the description of codes referenced by other tables in the database.
                    
#### 1.1.5. public
                    
The schema "public" should remain empty. In the public schema you can find a table with a list of projection systems (spatial_ref_sys) as generated by the POSTGIS extension. It also stores all functions available in the postgresql database. 
                    
                    
### <a name="tables"></a> 1.2. TABLES
                    
This part describes the tables of the database essential for the user. This schema main and lu_tables contain respectively x tables. See Figure 4 for an overview of the model. Queries on the [main tables](#maintables) are summarized in the tutorial section. 

<center>

![**Figure 4.** Wolfdiet Data Model](images/datamodel.png)

</center>
                        
#### 1.2.1. references
 
description of the table 

  * **column1** column description
* **column2** column description


```{R eval=TRUE, message=FALSE, echo=FALSE}
# Query the database (example: mtr of bejab in February)
query <- "SELECT * FROM main.references order by reference_id;"
kableExtra::kable(DBI::dbGetQuery(con, query), caption='Table 1. reference table')  %>%
  kableExtra::kable_styling(bootstrap_options =  c("striped","hover","scale_down"), position = "center", font_size = 8, full_width = T)
```

### <a name="views"></a> 1.3. VIEWS

A view is the result set of a stored query on the data. This database includes two views which are stored in the **main** schema. 

<!-- <center> -->

<!-- ![**Figure 4.** Screenshot of views, stored in the main schema of the postgresql database](Documentation_files/figure-png/views.png) -->

<!-- </center> -->

## <a name="tutorials"></a> 2. Tutorials

### <a name="connection"></a> 2.1. DATABASE CONNECTION PARAMETERS  

To access the database, whether it is from the psql console, through a database graphical user interface (e.g., pgadmin, dbeaver) or through another client software (e.g., R, matlab, qgis), connection always requires a minimum set of parameters:

  * **host** XXXXXXXXXX
* **port** 5432
* **database** wolfdiet
* **username** 
* **password** 

How the arguments are named will depend from the software.

### <a name="postgresql"></a> 2.2. POSTGRESQL

In this section a couple of examples are provided on how to use different SQL statements in the database, including FROM, WHERE, COUNT and JOIN.

#### 2.2.1. FROM

##### Access the <a name="maintables"></a> main tables in the database. 

See description of tables in [1.2. TABLES](#tables).

```{sql eval=FALSE}
--SELECT * FROM main.wolfdiet;

--SELECT * FROM main.references;

--SELECT * FROM main.othertables;

--SELECT * FROM main.othertables;

--SELECT * FROM main.othertables;

```


#### 2.2.2. WHERE

##### Select based on specific value
```{sql eval=FALSE}
--SELECT * 
--FROM main.table
--WHERE column = '';
```

##### Select multiple 
```{sql eval=FALSE}
--SELECT * 
--FROM main.table
--WHERE column in ('a','b')
```

##### Select this information that start with a letter
```{sql eval=FALSE}
--SELECT *
--FROM main.table
--WHERE column LIKE ('K%');
```

#### 2.2.3. COUNT 

##### Count how many xx
```{sql eval=FALSE}
-- EXAMPLE COUNT 
```

#### 2.2.4. JOIN 

##### join this information with this information
```{sql eval=FALSE}
-- EXAMPLE JOIN 
```


### <a name="r"></a> 2.3. R

In this section we show how to interact with the database through R. This covers how to: 

#### 2.3.1. INSTALL WOLFDIET 

Download the zip file directly from [https://github.com/andreacorra/wolfdiet/blob/master/data/wolfdiet.zip](https://github.com/andreacorra/wolfdiet/blob/master/data/wolfdiet.zip) 

```{R eval=FALSE}
# Install uvaRadar with the downloaded file
remotes::install_local('~/Downloads/wolfdiet.zip')
```

#### 2.3.2. LOAD PACKAGE
```{R eval=FALSE}
library(wolfdiet)
```

#### 2.3.3. USE PACKAGE

# load wolf diet data using common and scientific names in the columns
```{R eval=FALSE}
data(wolfdiet)
```

# load wolf diet data using scientific names in the columns 
```{R eval=FALSE}
wolf_s <-wolf(tax=TRUE)
```

# load wolf diet data using common names in the columns 
```{R eval=FALSE}
wolf_c <-wolf(tax=FALSE)
```

# load lookup tables
```{R eval=FALSE}
data(lookup)
```

## <a name="references"></a> 3. References

reference bla bla [doilink](doilink)

